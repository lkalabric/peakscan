---
title: "Pipeline Data Manipulation"
author: "Kathleen Kuesters"
date: '2022-09-07'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#Setting the working directory where scripts and data are found and calling the scripts
setwd("~/GitHub/P3_Pipeline/")
source("P3 Data manipulation Combo.R") #Data import scripts
source("JostD_KK.R")
source("Duplicate_check_KK.R")
source("Post_consolidation_manipulation.R")

#Load Packages
library(tidyr)
library(dplyr)
library(readr)
library(tidyverse)
library(readxl)
library(janitor)
```
#This will be need to be done manually
```{r}
#Load eggcount data
eggcount<-read_excel("~/GitHub/P3_Pipeline/Piraja_egg_counts_min.xlsx")

#Load the tdf version of the output for each marker from Peak Scoring.Rmd
Marker1<- read.delim("~/GitHub/P3_Pipeline/scores_29E6A_tdfex.txt") 
Marker2<- read.delim("~/GitHub/P3_Pipeline/scores_SMU31768_tdfex.txt")
Marker3<- read.delim("~/GitHub/P3_Pipeline/scores_SM13478_tdfex.txt")
Marker4<- read.delim("~/GitHub/P3_Pipeline/scores_15J15A_tdfex.txt")
Marker5<- read.delim("~/GitHub/P3_Pipeline/scores_13TAGA_tdfex.txt")
Marker6<- read.delim("~/Documents/GitHub/P3_Pipeline/scores_1F8A_tdfex.txt")
Marker7<- read.delim("~/GitHub/P3_Pipeline/scores_L46951_tdfex.txt")
Marker8<- read.delim("~/GitHub/P3_Pipeline/scores_LG1_sc276_tdfex.txt")
Marker9<- read.delim("~/GitHub/P3_Pipeline/scores_LG3_sc36b_tdfex.txt")
Marker10<- read.delim("~/GitHub/P3_Pipeline/scores_LG5_sc475_tdfex.txt")
Marker11<- read.delim("~/GitHub/P3_Pipeline/scores_R95529_tdfex.txt")
Marker12<- read.delim("~/GitHub/P3_Pipeline/scores_sc23b_tdfex.txt")
Marker13<- read.delim("~/GitHub/P3_Pipeline/scores_SM13410_tdfex.txt")
Marker14<- read.delim("~/GitHub/P3_Pipeline/scores_SMD28_tdfex.txt")
Marker15<- read.delim("~/GitHub/P3_Pipeline/scores_SMDA23_tdfex.txt")
Marker16<- read.delim("~/GitHub/P3_Pipeline/scores_SMMS13_tdfex.txt")
Marker17<- read.delim("~/GitHub/P3_Pipeline/scores_SMMS16_tdfex.txt")
Marker18<- read.delim("~/GitHub/P3_Pipeline/scores_SMMS17_tdfex.txt")
Marker19<- read.delim("~/GitHub/P3_Pipeline/scores_SMMS18_tdfex.txt")
Marker20<- read.delim("~/GitHub/P3_Pipeline/scores_SMMS2_tdfex.txt")
Marker21<- read.delim("~/Documents/GitHub/P3_Pipeline/scores_SMMS21_tdfex.txt")
Marker22<- read.delim("~/GitHub/P3_Pipeline/scores_SMMS3_tdfex.txt")
```
#Initial Data Manipulation
```{r}
#Initial data manipulation preparing for duplicate comparison
Marker1_IDM<-data_manipulation_for_peak_scan_output(Marker1)
Marker2_IDM<-data_manipulation_for_peak_scan_output(Marker2)
Marker3_IDM<-data_manipulation_for_peak_scan_output(Marker3)
Marker4_IDM<-data_manipulation_for_peak_scan_output(Marker4)
Marker5_IDM<-data_manipulation_for_peak_scan_output(Marker5)
Marker6_IDM<-data_manipulation_for_peak_scan_output(Marker6)
Marker7_IDM<-data_manipulation_for_peak_scan_output(Marker7)
Marker8_IDM<-data_manipulation_for_peak_scan_output(Marker8)
Marker9_IDM<-data_manipulation_for_peak_scan_output(Marker9)
Marker10_IDM<-data_manipulation_for_peak_scan_output(Marker10)
Marker11_IDM<-data_manipulation_for_peak_scan_output(Marker11)
Marker12_IDM<-data_manipulation_for_peak_scan_output(Marker12)
Marker13_IDM<-data_manipulation_for_peak_scan_output(Marker13)
Marker14_IDM<-data_manipulation_for_peak_scan_output(Marker14)
Marker15_IDM<-data_manipulation_for_peak_scan_output(Marker15)
Marker16_IDM<-data_manipulation_for_peak_scan_output(Marker16)
Marker17_IDM<-data_manipulation_for_peak_scan_output(Marker17)
Marker18_IDM<-data_manipulation_for_peak_scan_output(Marker18)
Marker19_IDM<-data_manipulation_for_peak_scan_output(Marker19)
Marker20_IDM<-data_manipulation_for_peak_scan_output(Marker20)
Marker21_IDM<-data_manipulation_for_peak_scan_output(Marker21)
Marker22_IDM<-data_manipulation_for_peak_scan_output(Marker22)
```
#Jost D comparison between duplicate samples
```{r}
#This is where the Duplicate_check_KK.R will go which incorporates JostD_KK.R
```
#Post consolidation Data Manipulation
```{r}
#The names of the markers will change depending on your sample and will need to be edited manually
Marker1_PCM<-Post_consolidation_manipulation(Marker1_IDM,eggcount,'29E6A')
Marker2_PCM<-Post_consolidation_manipulation(Marker2_IDM,eggcount,'SMU31768')
Marker3_PCM<-Post_consolidation_manipulation(Marker3_IDM,eggcount,'SM13478')
Marker4_PCM<-Post_consolidation_manipulation(Marker4_IDM,eggcount,'15J15A')
Marker5_PCM<-Post_consolidation_manipulation(Marker5_IDM,eggcount,'13TAGA')
Marker6_PCM<-Post_consolidation_manipulation(Marker6_IDM,eggcount,'1F8A')
Marker7_PCM<-Post_consolidation_manipulation(Marker7_IDM,eggcount,'L46951')
Marker8_PCM<-Post_consolidation_manipulation(Marker8_IDM,eggcount,'LG1_sc276')
Marker9_PCM<-Post_consolidation_manipulation(Marker9_IDM,eggcount,'LG3_sc36b')
Marker10_PCM<-Post_consolidation_manipulation(Marker10_IDM,eggcount,'LG5_sc475')
Marker11_PCM<-Post_consolidation_manipulation(Marker11_IDM,eggcount,'R95529')
Marker12_PCM<-Post_consolidation_manipulation(Marker12_IDM,eggcount,'sc23b')
Marker13_PCM<-Post_consolidation_manipulation(Marker13_IDM,eggcount,'SM13410')
Marker14_PCM<-Post_consolidation_manipulation(Marker14_IDM,eggcount,'SMD28')
Marker15_PCM<-Post_consolidation_manipulation(Marker15_IDM,eggcount,'SMDA23')
Marker16_PCM<-Post_consolidation_manipulation(Marker16_IDM,eggcount,'SMMS13')
Marker17_PCM<-Post_consolidation_manipulation(Marker17_IDM,eggcount,'SMMS16')
Marker18_PCM<-Post_consolidation_manipulation(Marker18_IDM,eggcount,'SMMS17')
Marker19_PCM<-Post_consolidation_manipulation(Marker19_IDM,eggcount,'SMMS18')
Marker20_PCM<-Post_consolidation_manipulation(Marker20_IDM,eggcount,'SMMS2')
Marker21_PCM<-Post_consolidation_manipulation(Marker21_IDM,eggcount,'SMMS21')
Marker22_PCM<-Post_consolidation_manipulation(Marker22_IDM,eggcount,'SMMS3')
```
#Binding and Exporting for Next Steps
```{r}
#Combine Markers
All_frequencies<-rbind.fill(Marker1_PCM,Marker2_PCM,Marker3_PCM,Marker4_PCM,Marker5_PCM,Marker6_PCM,Marker7_PCM,Marker8_PCM,Marker9_PCM,Marker10_PCM,Marker11_PCM,Marker12_PCM,Marker13_PCM,Marker14_PCM,Marker15_PCM,Marker16_PCM,Marker17_PCM,Marker18_PCM,Marker19_PCM,Marker20_PCM,Marker21_PCM,Marker22_PCM)

#Export transposed data frame as tsv to working directory
write.table(All_frequencies, file = "All_frequencies.txt", col.names = NA, quote = FALSE, row.names = TRUE, sep = "\t") 
```